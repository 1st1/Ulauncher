language: python
services:
  - docker
before_install:
  - |
    if [ ! -z "$encrypted_103700d0e85f_key" ]; then
      openssl aes-256-cbc -K $encrypted_103700d0e85f_key -iv $encrypted_103700d0e85f_iv -in scripts/launchpad-secret.key.enc -out scripts/launchpad-secret.key -d
      openssl aes-256-cbc -K $encrypted_103700d0e85f_key -iv $encrypted_103700d0e85f_iv -in scripts/launchpad-public.key.enc -out scripts/launchpad-public.key -d
      openssl aes-256-cbc -K $encrypted_103700d0e85f_key -iv $encrypted_103700d0e85f_iv -in scripts/launchpad.ssh.tar.enc -out scripts/launchpad.ssh.tar -d
      openssl aes-256-cbc -K $encrypted_103700d0e85f_key -iv $encrypted_103700d0e85f_iv -in scripts/aur_key.enc -out scripts/aur_key -d
    fi
  - source ./scripts/common.sh
  - docker pull $BUILD_IMAGE
install:
  # this is to skip default "pip install -r requirements.txt" on travis
  - true
script:
  - export TRAVIS_TAG=6.6.6
  - if [ "$TRAVIS_PULL_REQUEST" != "false" ] || [ -z "$TRAVIS_TAG" ]; then ./ul run-ci; fi
  - if [ ! -z "$TRAVIS_TAG" ] && [ ! -z "$encrypted_103700d0e85f_key" ]; then ./ul make-release $TRAVIS_TAG; fi
  - export APP_VERSION=$(echo "$TRAVIS_TAG" | sed 's/-beta/~beta/')
branches:
  only:
  - master
  - dev
  - release-debug
  - python3
  - "/^\\d+.\\d+.\\d+/"

